/*! pace 1.2.4 | https://github.com.hubspot/pace | license: MIT */
(function () {
    var a = function () {
        function a(a) {
            this.settings = b.extend({}, c, a), this.bind()
        }
        "undefined" == typeof b && (window.Pace || (window.Pace = {}), b = window.Pace);
        var c = {
            catchupTime: 100,
            initialRate: .03,
            minTime: 250,
            ghostTime: 100,
            maxProgressPerFrame: 20,
            easeFactor: 1.25,
            startOnPageLoad: !0,
            restartOnPushState: !0,
            restartOnRequestAfter: 500,
            elements: {
                checkInterval: 100,
                selectors: ["body"]
            },
            eventLag: {
                minSamples: 10,
                sampleCount: 3,
                lagThreshold: 3
            },
            ajax: {
                trackMethods: ["GET", "POST"],
                trackWebSockets: !0,
                ignoreURLs: []
            }
        };
        b.options = c;
        var d = !1;

        a.prototype.bind = function () {
            if (this.settings.startOnPageLoad && (b.running || this.start()),
                this.settings.restartOnPushState && this.bindPushState())
                ;
        };

        a.prototype.bindPushState = function () {
            var a = this;
            if (window.history.pushState) {
                var b = window.history.pushState;
                window.history.pushState = function () {
                    return b.apply(this, arguments), a.restart()
                }
            }
        };

        a.prototype.start = function () {
            var a = this;
            b.running = !0,
                this.trigger("start"),
                b.running = !0,
                this.settings.elements && (this.elements = this.monitorElements()),
                this.settings.eventLag && (this.lag = this.monitorEventLag()),
                this.settings.ajax && this.monitorAjax(),
                this.render = this.render.bind(this),
                this.render()
        };

        a.prototype.restart = function () {
            this.trigger("restart"),
                this.stop(),
                this.start()
        };

        a.prototype.stop = function () {
            b.running = !1,
                this.trigger("stop"),
                this.elements && (this.elements.stop(), this.elements = null),
                this.lag && (this.lag.stop(), this.lag = null),
                this.render()
        };

        a.prototype.render = function () {
            if (b.running) {
                this.trigger("progress", b.progress);
                var a = this;
                requestAnimationFrame(function () {
                    a.render()
                })
            }
        };

        a.prototype.monitorElements = function () {
            function a() {
                for (var a = 0; a < c.settings.elements.selectors.length; a++) {
                    var b = document.querySelectorAll(c.settings.elements.selectors[a]);
                    if (b.length > 0) return b
                }
                return null
            }
            var b = 0,
                c = this;

            return {
                stop: function () {
                    clearInterval(d)
                },
                check: function () {
                    var d = a();
                    if (d) {
                        var e = 0;
                        b = d.length;
                        for (var f = 0; f < b; f++)
                            e += d[f].children.length;
                        var g = e / b;
                        if (g !== c.lastElementCount) {
                            c.lastElementCount = g,
                                c.progress = 100 * Math.min(g / c.settings.elements.maxElements, 1)
                        }
                    }
                },
                start: function () {
                    c.elementsInterval = setInterval(function () {
                        c.check()
                    }, c.settings.elements.checkInterval)
                }
            }
        };

        a.prototype.monitorEventLag = function () {
            function a() {
                f = Date.now(),
                    g = f - e,
                    e = f;
                for (var a = 0; a < h.length; a++)
                    h[a] === c && h.splice(a, 1);
                h.push(c),
                    d() < 3 && (h = [], i = null)
            }

            function b() {
                return Math.min.apply(Math, h)
            }

            function d() {
                var a = b();
                return a === 1 / 0 ? 0 : a
            }

            var e = Date.now(),
                f = e,
                g = 0,
                h = [],
                i = null,
                c = this;

            return {
                stop: function () {
                    clearInterval(i)
                },
                record: function () {
                    a()
                },
                start: function () {
                    i = setInterval(a, c.settings.eventLag.interval)
                }
            }
        };

        a.prototype.monitorAjax = function () {
            function a(a) {
                c.settings.ajax.trackMethods.indexOf(a.method) > -1 && (c.ajax(a.url, a.method))
            }
            var b = window.XMLHttpRequest,
                c = this;
            if (b) {
                var d = b.prototype.open;
                b.prototype.open = function (b, c) {
                    a({
                        method: b,
                        url: c
                    }),
                        d.apply(this, arguments)
                }
            }

            var e = window.WebSocket;
            e && (window.WebSocket = function (a) {
                var b = new e(a);
                return b.addEventListener("open", function () {
                    c.ajax(a, "GET")
                }),
                b
            })
        };

        a.prototype.ajax = function (a, b) {
            var c = this,
                d = ++e;
            f[d] = a;

            var g = function () {
                    delete f[d]
                },
                h = function () {
                    g(), c.record()
                };

            setTimeout(function () {
                f[d] && (g(), c.record())
            }, this.settings.restartOnRequestAfter),

            this.trigger("request", {
                url: a,
                method: b
            })
        };

        var e = 0,
            f = {};

        return a
    }();

    "undefined" != typeof module && module.exports ? module.exports = a :
        "function" == typeof define && define.amd ? define(function () { return a }) :
        (window.Pace || (window.Pace = {}), window.Pace = a)

}).call(this);
